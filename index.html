<!doctype html>

<html>
  <head>
    <title>video</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <link href='https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=PT+Sans:700' rel='stylesheet' type='text/css'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism.min.css" rel="stylesheet" />

    <script src="https://buttons.github.io/buttons.js"></script>

    <script type="module">
      import { React, ReactDOM } from 'https://unpkg.com/es-react@16.12.0/dev';
      import htm from 'https://unpkg.com/htm?module'
      import { endpoint } from 'https://cdn.skypack.dev/@octokit/endpoint';
      import marked from 'https://unpkg.com/marked@0.8.0/lib/marked.esm.js';

      const html = htm.bind(React.createElement);


      const Posts = (props) => {
        const [issues, setIssues] = React.useState();

        React.useEffect(() => {
          async function fetchIssues() {
            if (!issues) {
              const { url, ...options } = endpoint('GET /repos/:owner/:repo/issues', {
                owner: 'hjwu',
                repo: 'yt',
                headers: {
                },
              });
              
              const res = await fetch(url, options);
              setIssues(await res.json());

              Prism.highlightAll();
            }
          }

          fetchIssues();
        }, [issues]);

        const {
          search,
        } = window.location;
          return html`
          <div className="posts">
            ${(issues || [])
              .filter(({ user }) => user.login === 'hjwu' || user.login === 'hsinjungwu')
              .filter(({ number }) => !search || Number(search.slice(1)) === number)
			  .filter(({ state }) => state === 'open')
              .map(({
                title,
                body,
              }) => 
			  html`
				 ${search && html`
                    <a href='${body}' download='${title}'>點我下載${title}</a>
                  `}
              `)}
          </div>
        `;
      };

      ReactDOM.render(
        html`
          <${Posts} />
        `,
        document.querySelector('#issuance')
      )
    </script>
  </head>
  <body>
    <div id="issuance">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/components/prism-core.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/plugins/autoloader/prism-autoloader.min.js"></script>
  </body>
</html>

